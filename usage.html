<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Usage &#8212; phrosty 0.1.dev1+ge09c620a9 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=5a6b8c39" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=f3bc516d" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <script src="_static/documentation_options.js?v=f2789e37"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Development" href="development.html" />
    <link rel="prev" title="Installation" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo_black_filled.png" alt="Logo" />
    
  </a>
</p>



<p class="blurb">Software developed by the Roman SNPIT</p>






<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">phrosty API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Installation</a></li>
      <li>Next: <a href="development.html" title="next chapter">Development</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="installation.html" title="Previous document">Installation</a>
        </li>
        <li>
          <a href="development.html" title="Next document">Development</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="usage">
<h1><a class="toc-backref" href="#id2" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#usage" id="id2">Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#example-usage" id="id3">Example Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#manually-running-a-test-lightcurve" id="id4">Manually running a test lightcurve</a></p></li>
<li><p><a class="reference internal" href="#running-on-perlmutter" id="id5">Running on Perlmutter</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-up-the-environment" id="id6">Setting up the environment</a></p></li>
<li><p><a class="reference internal" href="#pick-a-place-to-work" id="id7">Pick a place to work</a></p></li>
<li><p><a class="reference internal" href="#get-phrosty" id="id8">Get phrosty</a></p></li>
<li><p><a class="reference internal" href="#locate-existing-directories" id="id9">Locate existing directories</a></p></li>
<li><p><a class="reference internal" href="#create-needed-directories" id="id10">Create needed directories</a></p></li>
<li><p><a class="reference internal" href="#secure-lists-of-images-for-your-supernova" id="id11">Secure lists of images for your supernova</a></p></li>
<li><p><a class="reference internal" href="#running-interactively" id="id12">Running interactively</a></p></li>
<li><p><a class="reference internal" href="#running-with-the-nsight-profiler" id="id13">Running with the NSight Profiler</a></p></li>
<li><p><a class="reference internal" href="#running-a-slurm-batch-job" id="id14">Running a SLURM batch job</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#phrosty-functionality" id="id15">Phrosty Functionality</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>Phrosty may be run from the command line by running <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">phrosty/pipeline.py</span></code> (assuming you are in the top level of a github checkout).  If you’re in <a class="reference internal" href="installation.html#phrosty-installation-prerequisites"><span class="std std-ref">the necessary environment to run phrosty</span></a>, then try running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">pipeline</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">c</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">phrosty_test_config</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>phrosty’s behavior, and where it looks to find various images and other files it needs, are defined by a yaml config file.  You can find two examples of these files in:
* <code class="docutils literal notranslate"><span class="pre">examples/perlmutter/phrosty_config.yaml</span></code>
* <code class="docutils literal notranslate"><span class="pre">phrosty/tests/phrosty_test_config.yaml</span></code></p>
<section id="example-usage">
<span id="id1"></span><h2><a class="toc-backref" href="#id3" role="doc-backlink">Example Usage</a><a class="headerlink" href="#example-usage" title="Link to this heading">¶</a></h2>
<p>In addition to the examples below, see <a class="reference internal" href="development.html#running-tests"><span class="std std-ref">Running Tests</span></a>.</p>
<section id="manually-running-a-test-lightcurve">
<span id="manual-test-lightcurve"></span><h3><a class="toc-backref" href="#id4" role="doc-backlink">Manually running a test lightcurve</a><a class="headerlink" href="#manually-running-a-test-lightcurve" title="Link to this heading">¶</a></h3>
<p>In this example, you will use data packaged with the photometry test archive to build a two-point lightcurve.</p>
<p>First, make sure your system meets the <a class="reference internal" href="installation.html#system-requirements"><span class="std std-ref">System Requirements</span></a> and that you’ve downloaded the roman-snpit docker image as described in the <a class="reference internal" href="installation.html#phrosty-installation-prerequisites"><span class="std std-ref">phrosty installation preqreuisties</span></a>.</p>
<p>Next, make sure you’ve pulled down the <code class="docutils literal notranslate"><span class="pre">phrosty</span></code> archive as described in <a class="reference internal" href="installation.html#install-from-sources"><span class="std std-ref">installing phrosty from sources</span></a>.  Make sure also to install the photomery test data, as described there.</p>
<p>Finally, follow the instructions under <a class="reference internal" href="installation.html#running-snpit-container"><span class="std std-ref">Running the SNPIT container</span></a>.</p>
<p>If all has gone well, you are now sitting inside a container that’s ready to run phrosty.  Verify that you’re in the container with <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-F</span> <span class="pre">/</span></code>.  Make sure that you see <code class="docutils literal notranslate"><span class="pre">dia_out_dir/</span></code>, <code class="docutils literal notranslate"><span class="pre">lc_out_dir/</span></code>, <code class="docutils literal notranslate"><span class="pre">photometry_test_data/</span></code>, and <code class="docutils literal notranslate"><span class="pre">phrosty_temp/</span></code> in the list of directories.  Next, run <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code>, and make sure it shows you a GPU with 40MB.  Part of that output will look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="o">|=========================================+========================+======================|</span>
<span class="o">|</span>   <span class="mi">0</span>  <span class="n">NVIDIA</span> <span class="n">A100</span><span class="o">-</span><span class="n">SXM4</span><span class="o">-</span><span class="mi">40</span><span class="n">GB</span>          <span class="n">Off</span> <span class="o">|</span>   <span class="mi">00000000</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">00.0</span> <span class="n">Off</span> <span class="o">|</span>                    <span class="mi">0</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>   <span class="mi">30</span><span class="n">C</span>    <span class="n">P0</span>             <span class="mi">52</span><span class="n">W</span> <span class="o">/</span>  <span class="mi">400</span><span class="n">W</span> <span class="o">|</span>       <span class="mi">1</span><span class="n">MiB</span> <span class="o">/</span>  <span class="mi">40960</span><span class="n">MiB</span> <span class="o">|</span>      <span class="mi">0</span><span class="o">%</span>      <span class="n">Default</span> <span class="o">|</span>
<span class="o">|</span>                                         <span class="o">|</span>                        <span class="o">|</span>             <span class="n">Disabled</span> <span class="o">|</span>
</pre></div>
</div>
<p>This shows a NVIDIA A100 GPU with 40GB of memory.  A different system might show:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="o">|=========================================+========================+======================|</span>
<span class="o">|</span>   <span class="mi">0</span>  <span class="n">NVIDIA</span> <span class="n">GeForce</span> <span class="n">RTX</span> <span class="mi">3080</span> <span class="n">Ti</span>     <span class="n">Off</span> <span class="o">|</span>   <span class="mi">00000000</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">00.0</span>  <span class="n">On</span> <span class="o">|</span>                  <span class="n">N</span><span class="o">/</span><span class="n">A</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">0</span><span class="o">%</span>   <span class="mi">60</span><span class="n">C</span>    <span class="n">P8</span>             <span class="mi">35</span><span class="n">W</span> <span class="o">/</span>  <span class="mi">350</span><span class="n">W</span> <span class="o">|</span>     <span class="mi">774</span><span class="n">MiB</span> <span class="o">/</span>  <span class="mi">12288</span><span class="n">MiB</span> <span class="o">|</span>      <span class="mi">1</span><span class="o">%</span>      <span class="n">Default</span> <span class="o">|</span>
</pre></div>
</div>
<p>This system has a NVIDIA RTX 3080 Ti consumer graphics card.  Notice that it only has 12288MiB of memory; 12GB of memory is not enough to run the example.</p>
<p>Inside the container, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">phrosty</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<p>That will install the checked out version of phrosty in your currently running environment.  Note that if you exit the container and run a new container, you will have to <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span></code> phrosty again, as the changes you make to a container only persist as long as that same container is still running.</p>
<p>Next, try running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SNPIT_CONFIG</span><span class="o">=</span><span class="n">phrosty</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">phrosty_test_config</span><span class="o">.</span><span class="n">yaml</span> <span class="n">python</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">pipeline</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span> <span class="o">|</span> <span class="n">less</span>
</pre></div>
</div>
<p>You should see all the options you can pass to phrosty.  There are a lot, because there are (verbose) options for everything that’s in the config file.  Press <code class="docutils literal notranslate"><span class="pre">q</span></code> to get out of <code class="docutils literal notranslate"><span class="pre">less</span></code>.</p>
<p>Try running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SNPIT_CONFIG</span><span class="o">=</span><span class="n">phrosty</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">phrosty_test_config</span><span class="o">.</span><span class="n">yaml</span> <span class="n">python</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">pipeline</span><span class="o">.</span><span class="n">py</span> \
  <span class="o">--</span><span class="n">oid</span> <span class="mi">20172782</span> \
  <span class="o">--</span><span class="n">ra</span> <span class="mf">7.551093401915147</span> \
  <span class="o">--</span><span class="n">dec</span> <span class="o">-</span><span class="mf">44.80718106491529</span> \
  <span class="o">-</span><span class="n">b</span> <span class="n">Y106</span> \
  <span class="o">-</span><span class="n">t</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_instances_templates_1</span><span class="o">.</span><span class="n">csv</span> \
  <span class="o">-</span><span class="n">s</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_instances_science_2</span><span class="o">.</span><span class="n">csv</span> \
  <span class="o">-</span><span class="n">p</span> <span class="mi">3</span> <span class="o">-</span><span class="n">w</span> <span class="mi">3</span> \
  <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<p>If all is well, after it’s done running the output will end with something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">13</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">24</span> <span class="o">-</span> <span class="n">INFO</span><span class="p">]</span> <span class="o">-</span> <span class="n">Results</span> <span class="n">saved</span> <span class="n">to</span> <span class="o">/</span><span class="n">lc_out_dir</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">20172782</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_Y106_all</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>On your host system (as well as inside the container), you should see new files in wherever you put <code class="docutils literal notranslate"><span class="pre">lc_out_dir</span></code>, <code class="docutils literal notranslate"><span class="pre">dia_out_dir</span></code>, and <code class="docutils literal notranslate"><span class="pre">phrosty_temp</span></code>.  (Inside the container, these are at <code class="docutils literal notranslate"><span class="pre">/lc_out_dir</span></code>, <code class="docutils literal notranslate"><span class="pre">/dia_out_dir</span></code>, and <code class="docutils literal notranslate"><span class="pre">/phrosty_temp</span></code>.)</p>
</section>
<section id="running-on-perlmutter">
<span id="perlmutter-example"></span><h3><a class="toc-backref" href="#id5" role="doc-backlink">Running on Perlmutter</a><a class="headerlink" href="#running-on-perlmutter" title="Link to this heading">¶</a></h3>
<p>While the previous example should have worked on Perlmutter, this is a somewhat more realistic example.  It doesn’t use the photometry test data, but rather points to the full set of OpenUniverse2024 data available on Perlmutter.  This example is primarily intended for members of the Roman SN PIT, as it will require having an account on the NERSC Perlmutter cluster, and will require reading files that may not be accessible to people who aren’t in the right unix groups.</p>
<p>This example will <em>probably</em> not work on a login node.  It might.  However, there is only a single GPU on each login node, and because of how some very annoying python libraries are written (jax, I’m looking at you), often people have allocated a large fraction of the available GPU memory even if they don’t really need it.  You will probably need to run on a compute node.  This is described below.</p>
<section id="setting-up-the-environment">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Setting up the environment</a><a class="headerlink" href="#setting-up-the-environment" title="Link to this heading">¶</a></h4>
<p>Get your environment set up as described under the <a class="reference internal" href="installation.html#phrosty-installation-prerequisites"><span class="std std-ref">phrosty installation prerequisites</span></a>.</p>
</section>
<section id="pick-a-place-to-work">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Pick a place to work</a><a class="headerlink" href="#pick-a-place-to-work" title="Link to this heading">¶</a></h4>
<p>Work in one of two places.  You make yourself a subdirectory underneath <code class="docutils literal notranslate"><span class="pre">/pscratch/sd/&lt;u&gt;/&lt;username&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;username&gt;</span></code> is your NERSC username and <code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;u&gt;</span></code> is the first letter of your username.  (You can get to this directory with <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">$SCRATCH</span></code>; this is your top-level scratch directory, and NERSC sets the <code class="docutils literal notranslate"><span class="pre">SCRATCH</span></code> environment variable to point to it.)  Alternatively, you can create yourself a subdirectory somewhere underneath <code class="docutils literal notranslate"><span class="pre">/global/cfs/cdirs/m4385/users</span></code>.  This is the shared SNPIT space on the NERSC community file system, so if you’re going to work there, be aware that you’re using up our shared file allocation.  At the moment, that’s not a worry.</p>
<p>I’m going to call the place you’ve picked to work your “parent” directory.</p>
</section>
<section id="get-phrosty">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Get phrosty</a><a class="headerlink" href="#get-phrosty" title="Link to this heading">¶</a></h4>
<p>In your parent directory, <a class="reference internal" href="installation.html#install-from-sources"><span class="std std-ref">clone the phrosty repository</span></a>.  For this example, you do not need to install the photometry test data.</p>
</section>
<section id="locate-existing-directories">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Locate existing directories</a><a class="headerlink" href="#locate-existing-directories" title="Link to this heading">¶</a></h4>
<p>phrosty currently reads data from the OpenUniverse sims.  On NERSC, you can find the necessary information at the following directories.  These directories will be bind-mounted to the locations in parentheses (see below re: bind mounting).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/dvs_ro/cfs/cdirs/lsst/shared/external/roman-desc-sims/Roman_data</span></code> (<code class="docutils literal notranslate"><span class="pre">/ou2024</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/dvs_ro/cfs/cdirs/lsst/www/DESC_TD_PUBLIC/Roman+DESC/PQ+HDF5_ROMAN+LSST_LARGE</span></code> (<code class="docutils literal notranslate"><span class="pre">/ou2024_snana</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/dvs_ro/cfs/cdirs/lsst/www/DESC_TD_PUBLIC/Roman+DESC/ROMAN+LSST_LARGE_SNIa-normal</span></code> (<code class="docutils literal notranslate"><span class="pre">/ou2024_snana_lc_dir</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/dvs_ro/cfs/cdirs/lsst/www/DESC_TD_PUBLIC/Roman+DESC/sims_sed_library</span></code> (<code class="docutils literal notranslate"><span class="pre">/ou2024_sims_sed_library</span></code>)</p></li>
</ul>
</section>
<section id="create-needed-directories">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">Create needed directories</a><a class="headerlink" href="#create-needed-directories" title="Link to this heading">¶</a></h4>
<p>You need to make the following directories.  (They don’t have to have exactly these names.  However, for purposes of the example, create these directories with these names as subdirectories under your parent directory.)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dia_out_dir</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lc_out_dir</span></code></p></li>
</ul>
<p>In addition, create a directory <code class="docutils literal notranslate"><span class="pre">phrosty_temp</span></code> somewhere underneath <code class="docutils literal notranslate"><span class="pre">$SCRATCH</span></code>, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir $SCRATCH/phrosty_temp
</pre></div>
</div>
<p>This directory will be mounted to <code class="docutils literal notranslate"><span class="pre">/phrosty_temp</span></code> inside the container.  (The further examples below will assume that this is where you made it.)</p>
</section>
<section id="secure-lists-of-images-for-your-supernova">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Secure lists of images for your supernova</a><a class="headerlink" href="#secure-lists-of-images-for-your-supernova" title="Link to this heading">¶</a></h4>
<p>Pick a supernova to run on.  TODO: more information.</p>
<p>For this example, we’re going to run on the object with id 20172782.  In the <code class="docutils literal notranslate"><span class="pre">examples/perlmutter</span></code> directory under your <code class="docutils literal notranslate"><span class="pre">phrosty</span></code> checkout), you can find three <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files that have information about the template and/or science images we’re going to use:
* <code class="docutils literal notranslate"><span class="pre">20172782_instances_templates_1.csv</span></code> — a single R-band template image
* <code class="docutils literal notranslate"><span class="pre">20172782_instances_templates_10.csv</span></code> — 10 R-band template images
* <code class="docutils literal notranslate"><span class="pre">20172782_instances_science.csv</span></code> — 53 science images
* <code class="docutils literal notranslate"><span class="pre">20172782_instances_science_2.csv</span></code> — 2 science images</p>
<p>(Template images where chosen based on their simulated date relative to when the simulated supernova was active.)</p>
<p>For this example, you don’t have to do anything, you will just use the files that are there.  However, if you are pushing this further, you will need to know how to find files, and how to construct your own <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files.</p>
<p>If you look at these <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files, there are give pieces of information on each line:
* The filename of the OpenUniverse image, relative to <code class="docutils literal notranslate"><span class="pre">/ou2024/RomanTDS/images</span></code> inside the container (see below).  On Perlmutter outside the container, these are relative to <code class="docutils literal notranslate"><span class="pre">/dvs_ro/cfs/cdirs/lsst/shared/external/roman-desc-sims/Roman_data/RomanTDS/images</span></code>.
* The pointing of the image
* The SCA on which the supernova is present for this pointing
* The MJD of the pointing
* The band (filter) of the exposure</p>
</section>
<section id="running-interactively">
<span id="perlmutter-interactive"></span><h4><a class="toc-backref" href="#id12" role="doc-backlink">Running interactively</a><a class="headerlink" href="#running-interactively" title="Link to this heading">¶</a></h4>
<p>The easiest way to just run something is to do it on an interactive node on Perlmutter.  (See <a class="reference internal" href="#perlmutter-running-slurm"><span class="std std-ref">below</span></a> for running it with slurm.)</p>
<p>First, get yourself a session on an interactive GPU node with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">salloc</span> <span class="o">-</span><span class="n">t</span> <span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="n">A</span> <span class="n">m4385</span> <span class="o">--</span><span class="n">constraint</span><span class="o">=</span><span class="n">gpu</span> <span class="o">-</span><span class="n">q</span> <span class="n">interactive</span>
</pre></div>
</div>
<p>after a minute or so, that should log you into one of the nodes with a session that will last 4 hours.  (This is overkill; if you know it won’t be that long, shorten the time after the <code class="docutils literal notranslate"><span class="pre">-t</span></code> flag.)  You can verify that you’re on a compute node by running <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code>; you should see four different GPUs listed each with either 40MB or 80GB of memory, but no GPU processes running.</p>
<p>cd into your “parent” directory (if you’re not there already).</p>
<p>Look at the file <code class="docutils literal notranslate"><span class="pre">phrosty/examples/perlmutter/interactive_podman.sh</span></code>.  (There’s no need to edit it; this is so you can see what’s going on.  If you read all of the <a class="reference internal" href="installation.html#phrosty-installation"><span class="std std-ref">installation instructions</span></a>, you will recognize a lot of what’s there.)  You’ll see number of <code class="docutils literal notranslate"><span class="pre">--mount</span></code> parameters.  Each of these takes a directory on the host machine (the <code class="docutils literal notranslate"><span class="pre">source</span></code>) and maps it to a directory inside the podman container (the <code class="docutils literal notranslate"><span class="pre">target</span></code>); this is “bind mounting”.  For example, you will see your phrosty checkout goes to <code class="docutils literal notranslate"><span class="pre">/phrosty</span></code> inside the container.  In addition, several environment variables are set, and an “annotation” that is needed for <code class="docutils literal notranslate"><span class="pre">podman-hpc</span></code> to be able to handle accessing directories that are group-readable, but not world-readable.</p>
<p>Now do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">interactive_podman</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>This will create a container from the <code class="docutils literal notranslate"><span class="pre">roman-snpit-env</span></code> image, and put in a bash shell inside the container.  This will put you inside the container.  Your prompt will change to something like <code class="docutils literal notranslate"><span class="pre">root&#64;56356f1a4b9b:/usr/src#</span></code> (where the hex barf will be different every time).  At any time, run <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-F</span> <span class="pre">/</span></code>; if you see directories <code class="docutils literal notranslate"><span class="pre">phrosty</span></code>, <code class="docutils literal notranslate"><span class="pre">phrosty_temp</span></code>, <code class="docutils literal notranslate"><span class="pre">dia_out_dir</span></code>, and the others that were mounted by <code class="docutils literal notranslate"><span class="pre">interactive_podman.sh</span></code>, then you know you’re working inside the container, rather than on the host machine.  Verify that the GPUs are visible inside the container with <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code>.</p>
<p>Go to the <code class="docutils literal notranslate"><span class="pre">/home</span></code> directory, which is where your parent directory should be mounted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span>
</pre></div>
</div>
<p>The main Python executable for running the pipeline is <code class="docutils literal notranslate"><span class="pre">phrosty/phrosty/pipeline.py</span></code>.  Run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SNPIT_CONFIG</span><span class="o">=</span><span class="n">phrosty</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">phrosty_config</span><span class="o">.</span><span class="n">yaml</span> <span class="n">python</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">phrosty</span><span class="o">/</span><span class="n">pipeline</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>to see how it works, and to see what the various parameters you can specify are.</p>
<p>Run this on your example lightcurve with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">phrosty</span><span class="o">/</span><span class="n">pipeline</span><span class="o">.</span><span class="n">py</span> \
  <span class="o">-</span><span class="n">c</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">phrosty_config</span><span class="o">.</span><span class="n">yaml</span> \
  <span class="o">--</span><span class="n">oid</span> <span class="mi">20172782</span> \
  <span class="o">-</span><span class="n">r</span> <span class="mf">7.551093401915147</span> \
  <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="mf">44.80718106491529</span> \
  <span class="o">-</span><span class="n">b</span> <span class="n">R062</span> \
  <span class="o">-</span><span class="n">t</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_instances_templates_1</span><span class="o">.</span><span class="n">csv</span> \
  <span class="o">-</span><span class="n">s</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_instances_science_2</span><span class="o">.</span><span class="n">csv</span> \
  <span class="o">-</span><span class="n">p</span> <span class="mi">3</span> \
  <span class="o">-</span><span class="n">w</span> <span class="mi">3</span>
</pre></div>
</div>
<p>(If you run with <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files that have larger number of images, you probably want to pass a larger number to <code class="xref py py-obj docutils literal notranslate"><span class="pre">-p</span></code>; this is a number of parallel CPU processes that will run at once, and is limited by how many CPUs and how much memory you have available.  The code will only run one GPU process at once.  You can also try increasing <code class="xref py py-obj docutils literal notranslate"><span class="pre">-w</span></code>, but this is more limited by filesystem performance than the number of CPUs and the amount of memory you have available.  We’ve set these both to 3 right now because there are only 3 files being processed (one template and two science images).  Empirically, on Perlmutter nodes, you can go up to something like <code class="xref py py-obj docutils literal notranslate"><span class="pre">-p</span> <span class="pre">15</span></code>; while there are (many) more CPUs than that, memory is the limiting factor.  Also, empirically, on Perlmutter, you can go up to something like <code class="xref py py-obj docutils literal notranslate"><span class="pre">-w</span> <span class="pre">5</span></code> before you reach the point of diminishing returns.  This is more variable, because whereas you have the node’s CPUs to yourself, you’re sharing the filesystem with the rest of the users of the system.)</p>
<p>If all is well, you should see a final line that looks something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span> <span class="mi">18</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">05</span> <span class="o">-</span> <span class="n">phrosty</span> <span class="o">-</span> <span class="n">INFO</span><span class="p">]</span> <span class="n">Results</span> <span class="n">saved</span> <span class="n">to</span> <span class="o">/</span><span class="n">lc_out_dir</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">20172782</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_R062_all</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>Outside the container (i.e. on Perlmutter), you should be able to find the file <code class="docutils literal notranslate"><span class="pre">data/20172782/20172782_R062_all.csv</span></code> underneath the <code class="docutils literal notranslate"><span class="pre">lc_out_dir</span></code> subdirectory of your parent directory.  Congratulations, this has the lightcurve!  (TODO: document the columns of this <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file, but you can approximately guess what they are based on the column headers.)</p>
<p>You will also find new files in the <code class="docutils literal notranslate"><span class="pre">dia_out_dir</span></code> subdirectory, including several large <code class="docutils literal notranslate"><span class="pre">.fits</span></code> files.</p>
</section>
<section id="running-with-the-nsight-profiler">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">Running with the NSight Profiler</a><a class="headerlink" href="#running-with-the-nsight-profiler" title="Link to this heading">¶</a></h4>
<p><strong>WARNING</strong>: this section has not been tested recently so may be out of date.  TODO: try this again and update the docs after so doing.</p>
<p>When developing/debugging the pipeline, it’s useful to run with a profiler, so you can see where the code is spending most of its time.  The huge <code class="docutils literal notranslate"><span class="pre">roman-snpit-env:cuda-dev</span></code> Docker image includes the NVIDIA NSight Systems profiler, and (at least as of this writing) the <em>phrosty</em> code includes hooks to flag parts of the code to the nsight profiler.  You can generate a profile for your code by doing everything described in <a class="reference internal" href="#perlmutter-interactive"><span class="std std-ref">Running interactively</span></a> above, only replacing the final <code class="docutils literal notranslate"><span class="pre">python</span></code> command with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nsys</span> <span class="n">profile</span> \
  <span class="o">--</span><span class="n">trace</span><span class="o">-</span><span class="n">fork</span><span class="o">-</span><span class="n">before</span><span class="o">-</span><span class="n">exec</span><span class="o">=</span><span class="n">true</span> \
  <span class="o">--</span><span class="n">python</span><span class="o">-</span><span class="n">backtrace</span><span class="o">=</span><span class="n">cuda</span> \
  <span class="o">--</span><span class="n">python</span><span class="o">-</span><span class="n">sampling</span><span class="o">=</span><span class="n">true</span> \
  <span class="o">--</span><span class="n">trace</span><span class="o">=</span><span class="n">cuda</span><span class="p">,</span><span class="n">nvtx</span><span class="p">,</span><span class="n">cublas</span><span class="p">,</span><span class="n">cusparse</span><span class="p">,</span><span class="n">cudnn</span><span class="p">,</span><span class="n">cudla</span><span class="p">,</span><span class="n">cusolver</span><span class="p">,</span><span class="n">opengl</span><span class="p">,</span><span class="n">openacc</span><span class="p">,</span><span class="n">openmp</span><span class="p">,</span><span class="n">osrt</span><span class="p">,</span><span class="n">mpi</span><span class="p">,</span><span class="n">nvvideo</span><span class="p">,</span><span class="n">vulkan</span><span class="p">,</span><span class="n">python</span><span class="o">-</span><span class="n">gil</span> \
  <span class="n">python</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">phrosty</span><span class="o">/</span><span class="n">pipeline</span><span class="o">.</span><span class="n">py</span> \
    <span class="o">-</span><span class="n">c</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="n">phrosty_config</span><span class="o">.</span><span class="n">yaml</span> \
    <span class="o">--</span><span class="n">oid</span> <span class="mi">20172782</span> \
    <span class="o">-</span><span class="n">r</span> <span class="mf">7.551093401915147</span> \
    <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="mf">44.80718106491529</span> \
    <span class="o">-</span><span class="n">b</span> <span class="n">R062</span> \
    <span class="o">-</span><span class="n">t</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_instances_templates_1</span><span class="o">.</span><span class="n">csv</span> \
    <span class="o">-</span><span class="n">s</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_instances_science_2</span><span class="o">.</span><span class="n">csv</span> \
    <span class="o">-</span><span class="n">p</span> <span class="mi">3</span> \
    <span class="o">-</span><span class="n">w</span> <span class="mi">3</span>
</pre></div>
</div>
<p><em>Ideally</em>, this would create a file <code class="docutils literal notranslate"><span class="pre">report1.nsys-rep</span></code>, but something about that is broken; I’m not sure what.  It does create a file <code class="docutils literal notranslate"><span class="pre">report1.qdstrm</span></code>, which you can then somehow somewhere else convert to a <code class="docutils literal notranslate"><span class="pre">.nsys-rep</span></code> file.  On a Linux system, if you’ve installed the <code class="docutils literal notranslate"><span class="pre">nsight-compute</span></code> and <code class="docutils literal notranslate"><span class="pre">nsight-systems</span></code> packages (see <a class="reference external" href="https://docs.nvidia.com/nsight-systems/InstallationGuide/index.html)">Nvidia’s Nsight Systems installation guide</a>), you can download the <code class="docutils literal notranslate"><span class="pre">.qdstrm</span></code> file to your system and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nvidia</span><span class="o">/</span><span class="n">nsight</span><span class="o">-</span><span class="n">systems</span><span class="o">/</span><span class="mf">2024.4.2</span><span class="o">/</span><span class="n">host</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x64</span><span class="o">/</span><span class="n">QdstrmImporter</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;.</span><span class="n">qdstrm</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;.qstrm</span></code> is the file you downloaded.  (Note that the directory may have something other than <code class="docutils literal notranslate"><span class="pre">2024.4.2</span></code> in it, depending on what version you’ve installed.  For best comptibility with the version of Nsight in the current (as of this writing) snpit docker image, I recommend trying to install something close to <code class="docutils literal notranslate"><span class="pre">nsight-compute-2024.3.1</span></code> and  <code class="docutils literal notranslate"><span class="pre">nsight-systems-2024.4.2</span></code>; exactly what is avialable seems to vary with time.)  This should produce a file <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;.nsys-rep</span></code>.  Then, on your local desktop, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nsys</span><span class="o">-</span><span class="n">ui</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;.</span><span class="n">nsys</span><span class="o">-</span><span class="n">rep</span>
</pre></div>
</div>
<p>to look at the profile.</p>
</section>
<section id="running-a-slurm-batch-job">
<span id="perlmutter-running-slurm"></span><h4><a class="toc-backref" href="#id14" role="doc-backlink">Running a SLURM batch job</a><a class="headerlink" href="#running-a-slurm-batch-job" title="Link to this heading">¶</a></h4>
<p>For reference, see <a class="reference external" href="https://docs.nersc.gov/systems/perlmutter/running-jobs/">the NERSC documentation on running jobs on Perlmutter</a>.  You need to set up your environment and run all of the steps above <em>before</em> “Running interactively”.</p>
<p><strong>Create a job script</strong>: to submit a job to a batch queue, you need to write a slrum script, which is just a shell script with some directives in the comments at the top.  An example script may be found in the file <code class="docutils literal notranslate"><span class="pre">examples/perlmutter/20172782_slurm_demo.sh</span></code> in your phrosty checkout.  If you look at this script, you will see that it contains mostly a combination of the <code class="docutils literal notranslate"><span class="pre">podman-hpc</span></code> and <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">phrosty/phrosty/pipeline.py</span></code> commands above under “running interactively”.  Instead of starting a shell with <code class="docutils literal notranslate"><span class="pre">/bin/bash</span></code>, the <code class="docutils literal notranslate"><span class="pre">podman-hpc</span></code> command just runs the job directly.  It also adds a <code class="docutils literal notranslate"><span class="pre">-w</span> <span class="pre">/home</span></code> flag so it will be working in the right location.</p>
<p>At the top are the directives that control how the job is submitted.  Many of these you can leave as is.  (If you’re morbidly curious, see <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">full documentation on the sbatch command</a>.  The ones you are most likely to want to change are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--output</span> <span class="pre">&lt;filename&gt;</span></code> : this is the filename that will hold all of the output written to the console for your job.  It will be written in the directory where you run <code class="docutils literal notranslate"><span class="pre">slurm</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--qos</span> <span class="pre">shared</span></code> : this tells slurm which queue to submit to.  See <a class="reference external" href="https://docs.nersc.gov/jobs/policy/">NERSC’s information on Perlmutter queues</a>.  By default, you want to submit to the <code class="docutils literal notranslate"><span class="pre">shared</span></code> queue.  Phrosty only currently uses a single GPU.  Each Perlmutter node has 4 GPUs, so if you submit to a queue that gives you an entire node, you’re wasting it.  The shared queue has the advantage that <em>usually</em> jobs will start faster than they will on node-exclusive queues.  (You can sometimes wait days for a job on the regular queue to start!)  Additionally, our NERSC allocation will only be charged for the fraction of the node that we used.  However, when you’re first testing, and you’re only running a very small number of images, you might want to submit to the <code class="docutils literal notranslate"><span class="pre">debug</span></code> queue.  That allocates an entire node for the job, but _might_ start faster than jobs on the shared queue start.  (Try the shared queue first, though, because the job may well start within a few minutes.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--time</span> <span class="pre">00:20:00</span></code> : This is how long the job will run before the queue manager kills it.  The default, 20 minutes, <em>should</em> be plenty of time for the sample job that has 1 template image and 53 science images.  (However, if the NERSC filesystems are behaving poorly, it may not be enough time.)  If you’re running a bigger job, then you need to specify more time.  Right now, assume something like ~1-2 minutes per image (which you can divide by the number of processes you run with <code class="docutils literal notranslate"><span class="pre">-p</span></code>; see below), plus a few minutes of overhead.  Because phrosty is under heavy development and things are changing, this number will be highly variable.</p></li>
</ul>
<p>You can probably leave the rest of the flags as is.  The <code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code> and <code class="docutils literal notranslate"><span class="pre">--gpus-per-task</span></code> flags are set so that it will only ask for a quarter of a node.  (The queue manager is very particular about numbers passed to GPU nodes on the shared queue.  It needs you to ask for exactly 32 CPU cores for each GPU, and it needs you to ask for _exactly_ the right amount of memory.  The extra comment marks on the <code class="docutils literal notranslate"><span class="pre">####SBATCH</span> <span class="pre">--mem</span></code> line tell slurm to ignore it, as it seems to get the default right, and it’s not worth fiddling with it to figure out what you should ask for.  A simple calculation would suggest that 64GB per GPU is what you should ask for, but when you do that, slurm thinks you’re asking for 36 CPUs worth of memory, not 32 CPUs worth of memory.  The actual number is something like 56.12GB, but again, since the default seems to do the right thing, it’s not worth fiddling with this.)</p>
<p>If look look at the bottom of the script, you will see that the number of parallel worker jobs that phrosty uses is set to 9 (<code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">9</span></code> as a flag to <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">phrosty/phrosty/pipeline.py</span></code>).  The total number of processes that the python program runs at once is this, plus the number of FITS writer threads (given by <code class="docutils literal notranslate"><span class="pre">-w</span></code>), plus one for the master process that launches all of the others.   You will notice that this total is less than the 32 CPUs that we nominally have.  To be safe, assume that each of the <code class="docutils literal notranslate"><span class="pre">-p</span></code> processes will use ~6GB of memory.  By limiting ourselves to 9 processes, we should safely fit within the amount of CPU memory allocated to the job (allowing for some overhead for the driver process and the FITS writer processes).  (TODO: we really want to get this memory usage down.)   Based on performance, you might want to play with the number of FITS writing threads (the number after <code class="docutils literal notranslate"><span class="pre">-w</span></code>); assume that each FITS writer process will use ~1GB of memory.  (TODO: investigate how much they really use.)</p>
<p><strong>Make sure expected directories exists</strong>: If you look at the batch script, you’ll see a number of <code class="docutils literal notranslate"><span class="pre">--mount</span></code> flags that bind-mount directories inside the container.  From the location where you submit your job, all of the <code class="docutils literal notranslate"><span class="pre">source=</span></code> part of those <code class="docutils literal notranslate"><span class="pre">--mount</span></code> directives must be available.  For the demo, you will need to create the following directories underneath where you plan to submit the script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir lc_out_dir
mkdir dia_out_dir
mkdir $SCRATCH/phrosty_temp
</pre></div>
</div>
<p><strong>Submitting your job</strong>: Once you’ve are satisfied with your job script, submit it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sbatch</span> <span class="n">phrosty</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">perlmutter</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_slurm_demo</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>(Assuming you are running from the parent directory of your phrosty checkout.)</p>
<p>(replacing the argument with the actual name of your script).  (This example assumes that your current working directory is the parent directory of your phrosty checkout.)  If all is well, you should see an output something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Submitted</span> <span class="n">batch</span> <span class="n">job</span> <span class="mi">35680404</span>
</pre></div>
</div>
<p>That number is the job id of your job.  If you see other things, they are probably error messages, and you need to fix what went wrong.</p>
<p><strong>Monitoring your job</strong>: If you run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">squeue</span> <span class="o">--</span><span class="n">me</span>
</pre></div>
</div>
<p>you will see all jobs you have submitted that are either pending or still running.  In the <code class="docutils literal notranslate"><span class="pre">ST</span></code> (short for “state”) column, if you see <code class="docutils literal notranslate"><span class="pre">PD</span></code>, it means your job is still pending, and hasn’t started yet.  If you see <code class="docutils literal notranslate"><span class="pre">R</span></code>, it means your job is running; in this case, the <code class="docutils literal notranslate"><span class="pre">TIME</span></code> column will tell you how long your job has been running.  If you see <code class="docutils literal notranslate"><span class="pre">CG</span></code>, it means your job has recently finished (either succesfully, or with an error), and the system is currently cleaning it up.  If you see nothing, it means either that your job failed to submit (in which case you should have gotten an error message after your <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command above), or that it’s finished.  (“Finished” may mean “exited right away with an error”.)  Look at your output file to see what happened.</p>
<p>While the job is running, you can look at the output file to see how far it’s gone and how it’s doing.  (This is the file you specified on the <code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--output</span></code> line of your slurm script)</p>
<p>If you want to see the status of jobs that have completed, there are a few jobs you can run; try each of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scontrol</span> <span class="n">show</span> <span class="n">job</span> <span class="o">&lt;</span><span class="n">jobid</span><span class="o">&gt;</span>
<span class="n">sacct</span> <span class="o">-</span><span class="n">j</span> <span class="o">&lt;</span><span class="n">jobid</span><span class="o">&gt;</span>
<span class="n">sacct</span> <span class="o">-</span><span class="n">j</span> <span class="o">&lt;</span><span class="n">jobid</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="n">jobid</span><span class="p">,</span><span class="n">jobname</span><span class="p">,</span><span class="n">maxvmsize</span><span class="p">,</span><span class="n">reqmem</span><span class="p">,</span><span class="n">cputime</span> <span class="o">--</span><span class="n">units</span><span class="o">=</span><span class="n">G</span>
<span class="n">seff</span> <span class="o">&lt;</span><span class="n">jobid</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>(For more things you can pass to <code class="docutils literal notranslate"><span class="pre">sacct</span></code>, see <a class="reference external" href="https://slurm.schedmd.com/sacct.html">its documentation</a>.)  For all of those, <code class="docutils literal notranslate"><span class="pre">&lt;jobid&gt;</span></code> is the ID of your job on the slurm system.  While the job is still running you can see that job id in the left column of the output of <code class="docutils literal notranslate"><span class="pre">squeue</span> <span class="pre">--me</span></code>.  After your job is over, you can look at the output file.  Assuming you used the example slurm script from this directory, you should see the jobid near the top of the output file.</p>
<p><strong>Checking job results:</strong> Look at your output file.  The last line should be something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2025</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">10</span> <span class="mi">15</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">32</span> <span class="o">-</span> <span class="n">phrosty</span> <span class="o">-</span> <span class="n">INFO</span><span class="p">]</span> <span class="n">Results</span> <span class="n">saved</span> <span class="n">to</span> <span class="o">/</span><span class="n">lc_out_dir</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">20172782</span><span class="o">/</span><span class="mi">20172782</span><span class="n">_R062_all</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<p>and, ideally, there should be no lines anywhere in the file with <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> near the beginning of the log message.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">/lc_out_dir/...</span></code> is the absolute path _inside_ the container; it maps to <code class="docutils literal notranslate"><span class="pre">lc_out_dir/...</span></code> underneath your working directory where you ran <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>.  You will find the lightcurve in that <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file.  There will also be a number of files written to the <code class="docutils literal notranslate"><span class="pre">dia_out_dir</span></code> directory.</p>
</section>
</section>
</section>
<section id="phrosty-functionality">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Phrosty Functionality</a><a class="headerlink" href="#phrosty-functionality" title="Link to this heading">¶</a></h2>
<p>&lt;&lt;ALSO DOCUMENT FUNCTIONALITY &amp;&gt;&gt;</p>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="installation.html" title="Previous document">Installation</a>
        </li>
        <li>
          <a href="development.html" title="Next document">Development</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2025, Roman Supernova PIT.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/usage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>